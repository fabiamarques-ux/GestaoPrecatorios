<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solicitação de Certidão - Ente Público | TRT 19ª Região</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos omitidos para brevidade, mantenha os estilos originais */
        body { font-family: 'Arial', sans-serif; margin: 0; padding: 20px; background-color: #f0f2f5; color: #343a40; display: flex; justify-content: center; align-items: center; min-height: 100vh; }
        .container { max-width: 600px; width: 100%; margin: 20px; background-color: #fff; padding: 40px; border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 25px; }
        .logo-trt { max-width: 250px; height: auto; margin-bottom: 25px; }
        .header h1 { color: #004a8f; font-size: 1.5em; margin: 0; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; color: #495057; }
        .form-group input, .form-group textarea { width: 100%; padding: 12px; border: 1px solid #ced4da; border-radius: 8px; box-sizing: border-box; font-size: 1em; }
        .btn-submit { width: 100%; padding: 15px; background-color: #20c997; color: white; border: none; border-radius: 8px; cursor: pointer; font-size: 1.1em; font-weight: bold; margin-top: 30px; }
        .message { margin-top: 25px; padding: 18px; border-radius: 8px; text-align: center; font-weight: bold; display: none; }
        .success { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <img src="https://site.trt19.jus.br/sites/default/files/logo-trt19.png" alt="Logo TRT 19ª Região" class="logo-trt">
        <h1>Solicitação de Certidão Negativa de Débito de Precatórios</h1>
        <p>Preencha o formulário abaixo para formalizar a sua solicitação.</p>
    </div>

    <form id="solicitacaoForm">
        <div class="form-group">
            <label for="cnpj">CNPJ do Ente Público: <span style="color: red;">*</span></label>
            <input type="text" id="cnpj" name="cnpj" placeholder="XX.XXX.XXX/XXXX-XX" maxlength="18" required oninput="formatCNPJ(this)" autocomplete="off">
        </div>
        <div class="form-group">
            <label for="nomeEnte">Nome Completo do Ente (Município/Estado/Órgão): <span style="color: red;">*</span></label>
            <input type="text" id="nomeEnte" name="nomeEnte" placeholder="Ex: Município de Maceió" required autocomplete="off">
        </div>
        <div class="form-group">
            <label for="email">E-mail para Recebimento da Certidão/Comunicações: <span style="color: red;">*</span></label>
            <input type="email" id="email" name="email" placeholder="contato@municipio.gov.br" required autocomplete="off">
        </div>
        <div class="form-group">
            <label for="solicitante">Nome do Solicitante/Responsável: <span style="color: red;">*</span></label>
            <input type="text" id="solicitante" name="solicitante" placeholder="Ex: Secretário(a) de Finanças" required autocomplete="off"> 
        </div>
        <div class="form-group">
            <label for="observacoes">Observações Adicionais (Finalidade da Certidão, etc.):</label>
            <textarea id="observacoes" name="observacoes" placeholder="Ex: Solicitação para fins de convênio com o Governo Federal." autocomplete="off"></textarea>
        </div>
        <button type="submit" class="btn-submit">
            <i class="fas fa-paper-plane"></i> Enviar Solicitação
        </button>
    </form>
    <div id="statusMessage" class="message"></div>
</div>

<script>
    function formatCNPJ(input) {
        let value = input.value.replace(/\D/g, "");
        if (value.length > 2) value = value.substring(0, 2) + '.' + value.substring(2);
        if (value.length > 6) value = value.substring(0, 6) + '.' + value.substring(6);
        if (value.length > 10) value = value.substring(0, 10) + '/' + value.substring(10);
        if (value.length > 15) value = value.substring(0, 15) + '-' + value.substring(15);
        input.value = value.substring(0, 18);
    }

    document.getElementById('solicitacaoForm').addEventListener('submit', function(event) {
        event.preventDefault();

        // Diagnóstico: Verifica se o localStorage é acessível
        try {
            localStorage.setItem('__test', 'test');
            localStorage.removeItem('__test');
        } catch (e) {
            alert('Falha ao Salvar!\n\nSeu navegador parece estar bloqueando o armazenamento de dados para arquivos locais (file://).\n\nPara que os formulários funcionem, por favor, utilize um servidor web local (como o "Live Server" no VSCode) para abrir os arquivos.');
            return;
        }
        
        const cnpj = document.getElementById('cnpj').value;
        const nomeEnte = document.getElementById('nomeEnte').value;
        const email = document.getElementById('email').value;
        const solicitante = document.getElementById('solicitante').value; 
        const observacoes = document.getElementById('observacoes').value;
        const statusMessage = document.getElementById('statusMessage');

        const dataAtual = new Date();
        const dataSolicitacao = `${dataAtual.getDate().toString().padStart(2, '0')}/${(dataAtual.getMonth() + 1).toString().padStart(2, '0')}/${dataAtual.getFullYear()}`;
        
        const novoId = dataAtual.getTime(); 

        const novoRegistro = {
            id: novoId, 
            cnpj: cnpj,
            ente: nomeEnte,
            dataSolicitacao: dataSolicitacao,
            solicitante: solicitante,
            email: email,
            observacoes: observacoes,
            status: 'PENDENTE'
        };

        let pendentes = [];
        const storedData = localStorage.getItem('certidoesPendentes');
        if (storedData) {
            try {
                pendentes = JSON.parse(storedData);
            } catch (e) {
                console.error("Erro ao parsear dados do localStorage:", e);
            }
        }

        pendentes.push(novoRegistro);
        localStorage.setItem('certidoesPendentes', JSON.stringify(pendentes));

        statusMessage.style.display = 'block';
        statusMessage.className = 'message success';
        statusMessage.innerHTML = `
            ✅ **Solicitação Recebida com Sucesso!**<br><br>
            A solicitação para o ente **${nomeEnte}** foi registrada no Painel de Controle.<br>
            Abra o arquivo 'controlecertidoes.html' para acompanhar e emitir a certidão.
        `;

        document.getElementById('solicitacaoForm').reset();
    });
</script>

</body>
</html>