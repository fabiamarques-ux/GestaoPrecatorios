<!DOCTYPE html>
<html lang="pt-BR">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Planilha de Liberação de Crédito</title>
    <style>
        /* DEFINIÇÃO DE CORES (AJUSTADAS PARA TURQUESA ESCURO) */
        :root {
            --primary-color: #008080;
            /* Verde Turquesa Principal (TRT - Mais Escuro) */
            --dark-accent: #006464;
            /* Turquesa Escuro para Hover/Destaque */
            --light-bg: #E0F0F0;
            /* Fundo Claro Turquesa */
            --very-light-bg: #F7FCFC;
            /* Fundo Muito Claro/Off-White */
            --info-border: #B0D0D0;
            /* Borda Clara */
            --success-bg: #CCEDED;
            /* Fundo para Resultados (Líquido) */
            --text-dark: #333;
            /* Cor do Texto Geral */
            --text-primary: #004040;
            /* Cor do Texto de Destaque */
        }

        /* Estilos Gerais */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f0f4f4;
            color: var(--text-dark);
        }

        .container {
            background-color: #ffffff;
            padding: 30px 40px;
            border-radius: 12px;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.1);
            max-width: 1000px;
            margin: 0 auto;
        }

        /* Cabeçalho */
        .header {
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid var(--primary-color);
            display: flex;
            align-items: center;
            position: relative;
        }

        .header img {
            max-height: 60px;
            width: auto;
            margin-right: 20px;
        }

        .header-titles {
            flex-grow: 1;
            text-align: center;
            display: flex;
            flex-direction: column;
        }

        .title-and-date {
            display: flex;
            justify-content: center;
            align-items: flex-end;
            gap: 20px;
            margin-bottom: 10px;
        }

        .header h1 {
            font-size: 1.8em;
            margin: 0;
            padding-top: 10px;
            color: var(--primary-color);
            line-height: 1.2;
        }

        .header-info-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            display: none;
        }

        .header-info-wrapper {
            display: flex;
            flex-direction: column;
            gap: 10px;
            width: 100%;
            align-items: center;
        }

        .header-info-line {
            display: flex;
            justify-content: center;
            gap: 20px;
            width: 100%;
        }

        .info-block {
            border: 1px solid var(--info-border);
            border-radius: 8px;
            padding: 10px 15px;
            background-color: var(--very-light-bg);
            display: flex;
            gap: 30px;
            align-items: flex-start;
        }

        .info-block.liberacao-date {
            border: none;
            background: none;
            padding: 0;
        }

        .info-block.process-block {
            display: block;
            padding: 10px 20px;
            text-align: left;
            min-width: 420px;
        }

        .process-input-group {
            display: flex;
            align-items: center;
            gap: 2px;
        }

        .separator {
            font-weight: bold;
            color: var(--text-dark);
            font-size: 1em;
            margin: 0 1px;
            white-space: nowrap;
        }

        .fixed-part {
            padding: 5px 4px;
            border: 1px solid var(--info-border);
            border-radius: 4px;
            background-color: #e9ecef;
            font-weight: bold;
            color: #555;
            font-size: 1em;
            white-space: nowrap;
        }

        .header-item {
            text-align: center;
            width: auto;
        }

        .header-label {
            font-size: 0.9em;
            font-weight: 600;
            color: var(--text-primary);
            display: block;
            margin-bottom: 3px;
        }

        .header-input {
            border: 1px solid var(--info-border);
            padding: 5px 8px;
            border-radius: 4px;
            width: 130px;
            text-align: center;
            font-size: 1em;
            transition: border-color 0.3s;
        }

        .header-input-large {
            width: 280px;
        }

        .header-input.process-part,
        .header-input.process-subpart,
        .header-input.process-year,
        .header-input.process-unit {
            text-align: center;
            width: 70px;
            padding: 5px 2px;
        }

        .header-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        /* Estilo específico para o campo de display de Valor Bruto no Header */
        .header-bruto-display {
            width: 280px;
            text-align: right;
            background-color: #e9ecef;
            color: var(--text-primary);
            padding: 5px 8px;
            border: 1px solid var(--info-border);
            border-radius: 4px;
            font-weight: bold;
            display: block;
            min-height: 20px;
            /* Garante altura mínima */
            box-sizing: border-box;
        }


        /* Estilo para as gavetas expansíveis */
        details {
            margin-bottom: 20px;
            border: 1px solid var(--info-border);
            border-radius: 8px;
            background-color: var(--very-light-bg);
            transition: box-shadow 0.2s;
        }

        details:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }

        summary {
            font-size: 1.4em;
            font-weight: bold;
            padding: 15px;
            color: var(--primary-color);
            background-color: var(--light-bg);
            cursor: pointer;
            outline: none;
            border-bottom: 1px solid var(--info-border);
            border-radius: 8px 8px 0 0;
            display: list-item;
            list-style: none;
            transition: background-color 0.2s;
        }

        summary:hover {
            background-color: var(--info-border);
        }

        details:not([open])>summary {
            border-bottom: none;
            border-radius: 8px;
        }

        summary::-webkit-details-marker {
            display: none;
        }

        summary::before {
            content: '▶';
            margin-right: 10px;
            font-size: 0.8em;
            transition: transform 0.2s;
        }

        details[open]>summary::before {
            content: '▼';
        }

        .section-content {
            padding: 20px;
            background-color: white;
            border-radius: 0 0 8px 8px;
        }

        /* Layout de Formulário */
        .process-info-grid {
            display: grid;
            /* Novo layout para 2 colunas, já que Valor Depósito foi removido */
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .process-input-row {
            grid-column: 1 / -1;
            margin-bottom: 5px;
        }

        .process-input-row .process-block {
            min-width: 100%;
            padding: 10px;
            border: 1px solid var(--info-border);
            border-radius: 8px;
            background-color: var(--very-light-bg);
        }

        .process-input-row .process-input-group {
            justify-content: center;
            margin-top: 5px;
        }

        /* Estilos de inputs */
        .info-row {
            display: flex;
            gap: 30px;
            margin-bottom: 15px;
            flex-wrap: wrap;
        }

        .info-item {
            flex: 1;
            min-width: 300px;
        }

        .info-item label {
            font-weight: 600;
            display: block;
            margin-bottom: 5px;
            color: var(--text-dark);
        }

        .info-item input[type="text"],
        .info-item input[type="number"],
        .info-item .valor-display-style {
            /* Estilo para o display de valor bruto nos detalhes/tabela */
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 6px;
            box-sizing: border-box;
            transition: border-color 0.3s;
            text-align: right;
            background-color: #f0f0f0;
            color: var(--text-primary);
            font-weight: bold;
            display: block;
        }

        .info-item .valor-input {
            /* Estilo para o input principal agora nos detalhes */
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: right;
            box-sizing: border-box;
            font-weight: bold;
        }

        .info-item input:focus {
            border-color: var(--primary-color);
            outline: none;
            box-shadow: 0 0 5px rgba(0, 128, 128, 0.3);
        }

        /* Estilos para o bloco de Herdeiros/Advogados Adicionais */
        .parte-adicional-block {
            border: 1px dashed var(--info-border);
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 6px;
            background-color: var(--very-light-bg);
        }

        .parte-adicional-block h4 {
            margin-top: 0;
            color: var(--dark-accent);
            font-size: 1.1em;
            border-bottom: 1px solid var(--info-border);
            padding-bottom: 5px;
            margin-bottom: 10px;
        }

        .info-row.herdeiro-row .info-item:last-child {
            min-width: 150px;
            flex-grow: 0.5;
        }

        .add-button {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 6px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.3s;
        }

        .add-button:hover {
            background-color: var(--dark-accent);
        }

        .remove-button {
            background-color: #dc3545;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
        }


        /* Seção de Honorários */
        .honorarios-section {
            border: 1px solid var(--info-border);
            padding: 20px;
            margin-top: 20px;
            margin-bottom: 30px;
            border-radius: 8px;
            background-color: var(--light-bg);
        }

        .honorarios-options {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
        }

        .honorarios-option {
            display: flex;
            align-items: center;
        }

        .honorarios-option label {
            font-weight: normal;
            margin-left: 8px;
            cursor: pointer;
        }

        .honorarios-fields {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            align-items: end;
        }

        .honorarios-fields .field-group label {
            font-weight: 600;
            margin-bottom: 5px;
            display: block;
        }

        .honorarios-fields input[type="text"],
        .honorarios-fields input[type="number"] {
            width: 100%;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            text-align: right;
            box-sizing: border-box;
        }

        .honorarios-fields .result {
            font-weight: bold;
            padding: 10px;
            border: 1px solid var(--info-border);
            border-radius: 6px;
            background-color: var(--success-bg);
            text-align: right;
            color: var(--text-primary);
            min-height: 40px;
            display: block;
            line-height: 20px;
        }

        /* Tabela de Créditos */
        .creditos-table {
            width: 100%;
            border-collapse: separate;
            border-spacing: 0 8px;
            margin-top: 30px;
        }

        .creditos-table th,
        .creditos-table td {
            border: none;
            padding: 12px 15px;
            text-align: left;
        }

        .creditos-table thead th {
            background-color: var(--primary-color);
            color: white;
            font-weight: bold;
            border-bottom: 2px solid var(--dark-accent);
            border-radius: 6px 6px 0 0;
        }

        .creditos-table tbody tr {
            background-color: #f9f9f9;
            border-radius: 6px;
            transition: background-color 0.3s;
        }

        .creditos-table tbody tr:hover {
            background-color: #f1f1f1;
        }

        .creditos-table tbody tr:last-child {
            background-color: var(--success-bg);
            font-weight: bold;
        }

        .creditos-table tbody tr:last-child:hover {
            background-color: var(--success-bg);
        }

        .creditos-table .right-align {
            text-align: right;
            font-weight: bold;
            color: var(--text-dark);
        }

        /* O valor-input foi movido para o section-content de Dados do Processo */
        .creditos-table .valor-resultado {
            display: block;
            width: 100%;
            padding: 8px;
            border: none;
            border-radius: 4-px;
            text-align: right;
            background-color: #e9ecef;
            box-sizing: border-box;
            font-weight: bold;
        }

        .creditos-table .valor-liquido-resultado {
            background-color: transparent;
            color: var(--text-primary);
        }

        .creditos-table .row-title {
            color: var(--text-primary);
        }

        /* Estilos para INSS e IR (Valores de Retenção) */
        .valor-retencao-input {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            box-sizing: border-box;
            text-align: right;
            font-weight: bold;
            background-color: white;
            color: #c82333;
            /* Cor para destacar o débito */
        }

        .creditos-table .linha-retencao td {
            background-color: #fff3cd;
            /* Amarelo Claro para Retenções */
        }

        .creditos-table .linha-retencao td:first-child {
            color: #856404;
            /* Cor escura para o texto */
        }

        .creditos-table .linha-retencao td:last-child {
            font-weight: bold;
        }

        /* Novo estilo para Credores Adicionais */
        .creditos-table .credor-adicional-linha td {
            background-color: #f0f4f4;
            /* Fundo mais claro para credores */
            font-weight: 500;
        }

        .creditos-table .credor-adicional-linha td:last-child {
            font-weight: bold;
        }


        /* Estilos para o novo alerta dinâmico */
        .alerta-bruto-tabela {
            margin-top: 20px;
            padding: 15px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background-color: var(--light-bg);
            font-weight: bold;
            color: var(--text-primary);
            text-align: center;
            line-height: 1.4;
        }

        /* Estilos para o Relatório Final (Aparece abaixo da tabela) */
        .relatorio-final {
            margin-top: 40px;
            padding: 20px;
            border: 2px solid var(--dark-accent);
            border-radius: 8px;
            background-color: var(--light-bg);
            line-height: 1.6;
            display: none;
            /* Inicia oculto e é mostrado ao ter dados */
        }

        .relatorio-final h2 {
            color: var(--primary-color);
            border-bottom: 2px solid var(--primary-color);
            padding-bottom: 5px;
            margin-top: 0;
            font-size: 1.5em;
        }

        .relatorio-final h3 {
            color: var(--dark-accent);
            margin-top: 15px;
            margin-bottom: 5px;
            font-size: 1.2em;
        }

        .relatorio-final p {
            margin: 5px 0;
        }

        .relatorio-final .final-value {
            font-weight: bold;
            color: var(--text-dark);
            background-color: #e9ecef;
            padding: 5px 10px;
            border-radius: 4px;
            display: inline-block;
            margin-left: 10px;
        }

        .relatorio-final .final-value.liquido {
            background-color: var(--success-bg);
            color: var(--text-primary);
            font-size: 1.2em;
        }

        /* Rodapé */
        .button-group {
            margin-top: 30px;
            display: flex;
            justify-content: flex-start;
            gap: 15px;
        }

        .button-group button {
            padding: 10px 20px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.3s, transform 0.1s;
        }

        .button-group .primary {
            background-color: var(--primary-color);
            color: white;
        }

        .button-group .primary:hover {
            background-color: var(--dark-accent);
        }

        .button-group .secondary {
            background-color: #f8f9fa;
            color: var(--primary-color);
            border: 1px solid var(--primary-color);
        }

        .button-group .secondary:hover {
            background-color: #e2e6ea;
        }


        /* ======================================================= */
        /* ESTILOS DE IMPRESSÃO */
        /* (Manter estilos print do original para consistência) */
        /* ======================================================= */
        @media print {
            body {
                padding: 0;
                margin: 0;
                background-color: white !important;
                font-size: 11pt;
                /* Fonte menor para impressão */
            }

            .container {
                box-shadow: none !important;
                border: none !important;
                padding: 10px;
                max-width: none;
                width: 100%;
            }

            /* Ocultar elementos interativos */
            .button-group,
            .honorarios-options,
            .add-button,
            .remove-button {
                display: none !important;
            }

            /* FORÇAR ABERTURA E ESTILIZAÇÃO DAS SEÇÕES DE DETALHES */
            details {
                border: 1px solid var(--info-border);
                margin-bottom: 15px;
                break-inside: avoid;
                /* Evita quebras de página dentro da seção */
            }

            details summary {
                background-color: var(--light-bg) !important;
                color: var(--text-primary) !important;
                border-bottom: 1px solid var(--info-border) !important;
                list-style: none !important;
                font-size: 1.1em;
                padding: 10px 15px;
                /* Menos padding */
            }

            details summary::before {
                content: '';
                /* Remover o ícone de seta na impressão */
            }

            .section-content {
                background-color: white !important;
                padding: 10px 15px;
                border-radius: 0 0 8px 8px;
            }

            /* Estilização da tabela de créditos para impressão */
            .creditos-table {
                border-spacing: 0;
                margin-top: 15px;
                border: 1px solid var(--info-border);
            }

            .creditos-table thead th {
                background-color: #f0f4f4 !important;
                color: var(--text-primary) !important;
                border-bottom: 1px solid var(--info-border) !important;
                border-radius: 0 !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            .creditos-table th,
            .creditos-table td {
                padding: 8px 10px;
                border-right: 1px dotted #ccc;
            }

            .creditos-table tbody tr {
                background-color: white !important;
                border-bottom: 1px solid #eee;
            }

            .creditos-table tbody tr:last-child {
                background-color: #e0f0f0 !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            .creditos-table .valor-resultado,
            .creditos-table .valor-liquido-resultado {
                padding: 0;
                background: none !important;
                border: none !important;
                text-align: right;
            }

            /* FORÇAR EXIBIÇÃO DE INPUTS COMO TEXTO NA IMPRESSÃO */
            input[type="text"],
            input[type="number"],
            .valor-input,
            .header-input {
                /* Indentação para o valor */
                font-weight: bold !important;
                text-align: left !important;
                width: auto !important;
                box-shadow: none !important;
                display: inline !important;
                /* Para ficar na mesma linha da label */
                color: var(--text-dark) !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 5px !important;
                background: none !important;
            }

            .info-item label {
                display: inline !important;
                /* Para ficar na mesma linha do input */
                font-weight: 600;
                margin-bottom: 0;
            }

            .info-row {
                gap: 10px;
                margin-bottom: 5px;
            }

            /* ESTILIZAÇÃO PARA HONORÁRIOS */
            .honorarios-section {
                border: 1px dashed var(--info-border) !important;
                background-color: white !important;
                padding: 10px;
                margin-bottom: 15px;
                break-inside: avoid;
            }

            .honorarios-fields {
                display: flex !important;
                /* Usar flex para uma linha horizontal */
                gap: 20px;
                align-items: center;
                margin-top: 10px;
            }

            .honorarios-fields .field-group {
                flex: 1;
                min-width: 150px;
            }

            .honorarios-fields .field-group label {
                font-weight: 600 !important;
                display: inline !important;
            }

            /* Ocultar inputs e mostrar somente o resultado com destaque */
            .honorarios-fields input {
                display: none !important;
            }

            /* Mostrar o valor percentual/fixado ao lado do rótulo, mesmo que seja um input de texto */
            #adv-percentual,
            #perito-percentual,
            #adv-base-calculo,
            #perito-base-calculo,
            #adv-valor-fixado,
            #perito-valor-fixado {
                display: inline !important;
                font-weight: bold !important;
                width: auto !important;
                border: none !important;
                padding: 0 !important;
                margin: 0 5px !important;
                background: none !important;
            }

            /* Garantir que o resultado do honorário seja visível e formatado */
            .honorarios-fields .result {
                background-color: #e0f0f0 !important;
                color: var(--text-primary) !important;
                border: 1px solid var(--info-border) !important;
                padding: 5px 10px !important;
                min-height: auto;
                line-height: normal;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Estilização para Relatório Final */
            .relatorio-final {
                display: block !important;
                /* Força a exibição na impressão */
                margin-top: 25px !important;
                padding: 15px !important;
                border: 1px solid var(--info-border) !important;
                background-color: #ffffff !important;
                box-shadow: none !important;
                break-before: auto;
                /* Evita quebra de página desnecessária */
                break-inside: avoid;
            }

            .relatorio-final h2 {
                font-size: 1.3em !important;
                border-bottom: 1px solid var(--dark-accent) !important;
            }

            .relatorio-final h3 {
                font-size: 1em !important;
            }

            .relatorio-final .final-value.liquido {
                background-color: var(--success-bg) !important;
                -webkit-print-color-adjust: exact;
                color-adjust: exact;
            }

            /* Estilização das Mensagens Adicionais */
            .print-messages {
                display: block !important;
                margin-top: 30px;
                padding: 15px 0;
                border-top: 2px solid var(--primary-color);
                font-size: 1em;
                line-height: 1.6;
            }

            .print-messages p {
                margin: 8px 0;
                color: var(--text-dark);
                font-weight: 500;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <img src="https://site.trt19.jus.br/sites/default/files/logo-trt19.png" alt="Logo TRT19">
            <div class="header-titles">
                <div class="title-and-date">
                    <h1>PLANILHA DE LIBERAÇÃO DE CRÉDITO DE PRECATÓRIO/RPV</h1>
                    <div class="info-block liberacao-date">
                        <div class="header-item">
                            <span class="header-label">DATA DA LIBERAÇÃO:</span>
                            <input type="text" id="data-liberacao-header" class="header-input">
                        </div>
                    </div>
                </div>
                <div class="header-info-group">
                    <div class="header-info-wrapper">
                        <div class="header-info-line">
                            <div class="info-block process-block">
                                <span class="header-label">NÚMERO DO PROCESSO:</span>
                                <div class="process-input-group">
                                    <input type="text" id="proc-num" class="header-input process-part" maxlength="7"
                                        oninput="formatarNumero(this, 7)" placeholder="0000000">
                                    <span class="separator">-</span>
                                    <input type="text" id="proc-digito" class="header-input process-subpart"
                                        maxlength="2" oninput="formatarNumero(this, 2)" placeholder="00">
                                    <span class="separator">.</span>
                                    <input type="text" id="proc-ano" class="header-input process-year" maxlength="4"
                                        oninput="formatarNumero(this, 4)" placeholder="0000">
                                    <span class="separator">.5.19.</span>
                                    <input type="text" id="proc-vara" class="header-input process-unit" maxlength="4"
                                        oninput="formatarNumero(this, 4)" placeholder="0000">
                                </div>
                            </div>
                        </div>
                        <div class="header-info-line" style="margin-top: 10px;">
                            <div class="info-block" style="flex: 1;">
                                <div class="header-item">
                                    <span class="header-label">VALOR BRUTO TOTAL DO CRÉDITO:</span>
                                    <span id="valor-bruto-header" class="header-bruto-display">0,00</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <details open>
            <summary>Dados do Processo e Valores</summary>
            <div class="section-content">
                <div class="process-info-grid">

                    <div class="process-input-row">
                        <div class="process-block">
                            <span class="header-label">Nº PROCESSO:</span>
                            <div class="process-input-group">
                                <input type="text" id="proc-num" class="header-input process-part" maxlength="7"
                                    placeholder="" oninput="formatarNumero(this, 7)">
                                <span class="separator">-</span>
                                <input type="text" id="proc-digito" class="header-input process-subpart" maxlength="2"
                                    placeholder="" oninput="formatarNumero(this, 2)">
                                <span class="separator">.</span>
                                <input type="text" id="proc-ano" class="header-input process-year" maxlength="4"
                                    placeholder="" oninput="formatarNumero(this, 4)">
                                <span class="separator">.</span>
                                <span class="fixed-part">5</span>
                                <span class="separator">.</span>
                                <span class="fixed-part">19</span>
                                <span class="separator">.</span>
                                <input type="text" id="proc-vara" class="header-input process-unit" maxlength="4"
                                    placeholder="" oninput="formatarNumero(this, 4)">
                            </div>
                        </div>
                    </div>
                    <div class="info-row">
                        <div class="info-item">
                            <label for="valor-bruto-reclamante">VALOR TOTAL DA PLANILHA:</label>
                            <input type="text" id="valor-bruto-reclamante" class="valor-input"
                                name="valor-bruto-reclamante" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                        <div class="info-item">
                            <label for="valor-deposito-judicial">LÍQUIDO EXEQUENTE</label>
                            <input type="text" id="valor-deposito-judicial" class="valor-input"
                                name="valor-deposito-judicial" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                        <div class="info-item">
                            <label for="valor-deposito-judicial">FGTS A DEPOSITAR EM CONTA VINCULADA:</label>
                            <input type="text" id="valor-deposito-judicial" class="valor-input"
                                name="valor-deposito-judicial" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                    </div>

                    <div class="info-row" style="gap: 30px;">
                        <div class="info-item">
                            <label for="inss-reclamante">INSS (Reclamante):</label>
                            <input type="text" id="inss-reclamante" class="valor-input" placeholder="0,00"
                                oninput="formatarMoeda(this)">
                        </div>
                        <div class="info-item">
                            <label for="inss-reclamada">INSS (Reclamada - Cota Empregado):</label>
                            <input type="text" id="inss-reclamada" class="valor-input" placeholder="0,00"
                                oninput="formatarMoeda(this)">
                        </div>
                        <div class="info-item">
                            <label for="ir-valor">Imposto de Renda (IR):</label>
                            <input type="text" id="ir-valor" class="valor-input" placeholder="0,00"
                                oninput="formatarMoeda(this)">
                        </div>
                    </div>
                </div>
        </details>
        <details>
            <summary>Dados das Partes (Reclamante/Herdeiros)</summary>
            <div class="section-content">
                <div class="info-row">
                    <div class="info-item">
                        <label for="reclamante">Reclamante/Credor Principal (Espólio ou *De Cujus*):</label>
                        <input type="text" id="reclamante" name="reclamante">
                    </div>
                    <div class="info-item">
                        <label for="cpf">CPF/CNPJ:</label>
                        <input type="text" id="cpf" name="cpf" maxlength="18"
                            oninput="formatarDocumento(this, 'AMBOS')">
                    </div>
                </div>
                <hr style="margin: 20px 0; border: 0; border-top: 1px dashed var(--info-border);">
                <h4>Herdeiros/Sucessores como Credores (Art. 112 da Lei 8.213/91)</h4>
                <div id="herdeiros-list">
                </div>
                <button type="button" class="add-button" onclick="adicionarHerdeiro()">+ Adicionar Herdeiro</button>
            </div>
        </details>

        <details>
            <summary>Advogados (Honorários Contratuais Adicionais)</summary>
            <div class="section-content">
                <div class="honorarios-section">
                    <h4 style="margin-top: -5px; color: var(--dark-accent);">Honorários Contratuais (Principal)</h4>
                    <div class="info-row">
                        <div class="info-item" style="min-width: 400px; flex-grow: 2;">
                            <label for="adv-nome">Nome do Advogado/Sociedade:</label>
                            <input type="text" id="adv-nome" name="adv-nome">
                        </div>
                        <div class="info-item" style="min-width: 200px; flex-grow: 1;">
                            <label for="adv-cpf-cnpj">CPF/CNPJ:</label>
                            <input type="text" id="adv-cpf-cnpj" name="adv-cpf-cnpj" maxlength="18"
                                oninput="formatarDocumento(this, 'AMBOS')">
                        </div>
                    </div>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px dashed var(--info-border);">
                    <div class="honorarios-options">
                        <div class="honorarios-option">
                            <input type="radio" id="adv-percentual-opt" name="adv-calculo-tipo" value="percentual"
                                checked onchange="toggleAdvHonorariosFields()">
                            <label for="adv-percentual-opt">Percentual sobre a Base de Cálculo</label>
                        </div>
                        <div class="honorarios-option">
                            <input type="radio" id="adv-valor-fixado-opt" name="adv-calculo-tipo" value="fixado"
                                onchange="toggleAdvHonorariosFields()">
                            <label for="adv-valor-fixado-opt">Informar Valor Fixado</label>
                        </div>
                    </div>
                    <div id="adv-percentual-fields" class="honorarios-fields">
                        <div class="field-group">
                            <label for="adv-percentual">Percentual (%):</label>
                            <input type="text" id="adv-percentual" placeholder="" oninput="calcularHonorarios('adv')">
                        </div>
                        <div class="field-group">
                            <label for="adv-base-calculo">Base de Cálculo:</label>
                            <input type="text" id="adv-base-calculo" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                        <div class="field-group">
                            <label>Resultado:</label>
                            <span id="adv-resultado" class="result">0,00</span>
                        </div>
                    </div>
                    <div id="adv-fixado-fields" class="honorarios-fields" style="display: none;">
                        <div class="field-group">
                            <label for="adv-valor-fixado">Valor Fixado:</label>
                            <input type="text" id="adv-valor-fixado" placeholder="0,00" oninput="formatarMoeda(this)">
                        </div>
                    </div>
                </div>

                <hr style="margin: 30px 0; border: 0; border-top: 2px solid var(--primary-color);">

                <h4>Rateio de Honorários (Advogados Adicionais)</h4>
                <div id="adv-adicionais-list">
                </div>
                <button type="button" class="add-button" onclick="adicionarAdvogadoAdicional()">+ Adicionar
                    Advogado</button>
            </div>
        </details>

        <details>
            <summary>Cálculo dos Honorários Periciais</summary>
            <div class="section-content">
                <div class="honorarios-section"
                    style="margin-top: 0; margin-bottom: 0; padding: 0; border: none; background: none;">
                    <div class="info-row">
                        <div class="info-item" style="min-width: 400px; flex-grow: 2;">
                            <label for="perito-nome">Nome do Perito:</label>
                            <input type="text" id="perito-nome" name="perito-nome">
                        </div>
                        <div class="info-item" style="min-width: 200px; flex-grow: 1;">
                            <label for="perito-cpf-cnpj">CPF/CNPJ:</label>
                            <input type="text" id="perito-cpf-cnpj" name="perito-cpf-cnpj" maxlength="18"
                                oninput="formatarDocumento(this, 'AMBOS')">
                        </div>
                    </div>
                    <hr style="margin: 15px 0; border: 0; border-top: 1px dashed var(--info-border);">
                    <div class="honorarios-options">
                        <div class="honorarios-option">
                            <input type="radio" id="perito-percentual-opt" name="perito-calculo-tipo" value="percentual"
                                checked onchange="togglePeritoHonorariosFields()">
                            <label for="perito-percentual-opt">Percentual sobre a Base de Cálculo</label>
                        </div>
                        <div class="honorarios-option">
                            <input type="radio" id="perito-valor-fixado-opt" name="perito-calculo-tipo" value="fixado"
                                onchange="togglePeritoHonorariosFields()">
                            <label for="perito-valor-fixado-opt">Informar Valor Fixado</label>
                        </div>
                    </div>
                    <div id="perito-percentual-fields" class="honorarios-fields">
                        <div class="field-group">
                            <label for="perito-percentual">Percentual (%):</label>
                            <input type="text" id="perito-percentual" placeholder=""
                                oninput="calcularHonorarios('perito')">
                        </div>
                        <div class="field-group">
                            <label for="perito-base-calculo">Base de Cálculo:</label>
                            <input type="text" id="perito-base-calculo" placeholder="0,00"
                                oninput="formatarMoeda(this)">
                        </div>
                        <div class="field-group">
                            <label>Resultado:</label>
                            <span id="perito-resultado" class="result">0,00</span>
                        </div>
                    </div>
                    <div id="perito-fixado-fields" class="honorarios-fields" style="display: none;">
                        <div class="field-group">
                            <label for="perito-valor-fixado">Valor Fixado:</label>
                            <input type="text" id="perito-valor-fixado" placeholder="0,00"
                                oninput="formatarMoeda(this)">
                        </div>
                    </div>
                </div>
            </div>
        </details>

        <div class="alerta-bruto-tabela" id="alerta-bruto-tabela" style="display: none;">
        </div>

        <table class="creditos-table">
            <thead>
                <tr>
                    <th colspan="2">Credor/Natureza</th>
                    <th class="right-align" style="width: 200px;">Valor a Liberar (R$)</th>
                </tr>
            </thead>
            <tbody id="creditos-table-body">
                <tr>
                    <td class="row-title" colspan="2">Valor Bruto Total do Crédito</td>
                    <td class="right-align">
                        <span id="valor-bruto-tabela-display" class="valor-resultado valor-display-style">0,00</span>
                    </td>
                </tr>

                <tr class="linha-retencao">
                    <td class="row-title" colspan="2">Honorários Contratuais (Advogado Principal)</td>
                    <td class="right-align">
                        <span id="valor-honorarios-contratuais" class="valor-resultado valor-display-style">0,00</span>
                    </td>
                </tr>
                <tr class="linha-retencao">
                    <td class="row-title" colspan="2">Honorários Periciais</td>
                    <td class="right-align">
                        <span id="valor-honorarios-periciais" class="valor-resultado valor-display-style">0,00</span>
                    </td>
                </tr>

                <tr class="linha-retencao">
                    <td colspan="2" style="font-weight: 600;">(-) Retenção INSS (Reclamante)</td>
                    <td class="right-align">
                        <span id="valor-inss-reclamante-display"
                            class="valor-resultado valor-display-style">-0,00</span>
                    </td>
                </tr>
                <tr class="linha-retencao">
                    <td colspan="2" style="font-weight: 600;">(-) Retenção INSS (Reclamada - Cota Empregado)</td>
                    <td class="right-align">
                        <span id="valor-inss-reclamada-display" class="valor-resultado valor-display-style">-0,00</span>
                    </td>
                </tr>
                <tr class="linha-retencao">
                    <td colspan="2" style="font-weight: 600;">(-) Retenção Imposto de Renda (Valor)</td>
                    <td class="right-align">
                        <span id="valor-ir-display" class="valor-resultado valor-display-style">-0,00</span>
                    </td>
                </tr>
                <tr class="linha-total">
                    <td class="row-title" colspan="2" style="font-size: 1.1em; color: var(--text-primary);">VALOR
                        LÍQUIDO A LIBERAR</td>
                    <td class="right-align" style="font-size: 1.1em; color: var(--text-primary);">
                        <span id="valor-liquido-total" class="valor-resultado valor-liquido-resultado">0,00</span>
                    </td>
                </tr>
            </tbody>
        </table>

        <div class="relatorio-final" id="relatorio-final">
        </div>

        <div class="print-messages" style="display: none;">
        </div>

        <div class="button-group">
            <button type="button" class="secondary" onclick="imprimirPlanilha()">Imprimir/Gerar PDF</button>
            <button type="button" class="secondary" onclick="limparCampos()">Limpar Tudo</button>
            <button type="button" class="primary" onclick="gerarRelatorio()">Gerar Relatório Final</button>
            <button type="button" class="primary">Envio para PJe</button>
        </div>
    </div>
    <script>
        // =======================================================================
        // FUNÇÕES DE UTILIDADE
        // =======================================================================
        function getNumericValue(id) {
            const input = document.querySelector(`#${id}`);
            if (!input) return 0;
            const valorString = input.tagName === 'INPUT' ? input.value : input.textContent; // Verifica se é um campo de cálculo de resultado (com vírgula no BR format)
            const valorNumericoString = valorString.replace(/\./g, '').replace(',', '.').replace('R$', '').trim();
            return parseFloat(valorNumericoString) || 0;
        }

        function formatarMoedaParaExibicao(valor) {
            const num = parseFloat(valor);
            if (isNaN(num)) return "0,00";
            // Usa toLocaleString para formatar corretamente com separador de milhar e vírgula decimal
            return num.toLocaleString('pt-BR', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
        }

        function formatarNumero(input, maxLength) {
            let valor = input.value.replace(/\D/g, '');
            input.value = valor.substring(0, maxLength);
        }

        function formatarDocumento(input, tipo) {
            let valor = input.value.replace(/\D/g, '');
            let formato = '';

            if (tipo === 'CPF' || (tipo === 'AMBOS' && valor.length <= 11)) {
                // Formato CPF: 000.000.000-00
                if (valor.length > 0) formato = valor.substring(0, 3);
                if (valor.length > 3) formato += '.' + valor.substring(3, 6);
                if (valor.length > 6) formato += '.' + valor.substring(6, 9);
                if (valor.length > 9) formato += '-' + valor.substring(9, 11);
                input.value = formato;
            } else if (tipo === 'CNPJ' || (tipo === 'AMBOS' && valor.length > 11)) {
                // Formato CNPJ: 00.000.000/0000-00
                if (valor.length > 0) formato = valor.substring(0, 2);
                if (valor.length > 2) formato += '.' + valor.substring(2, 5);
                if (valor.length > 5) formato += '.' + valor.substring(5, 8);
                if (valor.length > 8) formato += '/' + valor.substring(8, 12);
                if (valor.length > 12) formato += '-' + valor.substring(12, 14);
                input.value = formato;
            } else {
                input.value = valor;
            }
        }

        function formatarMoeda(input) {
            // 1. Remove tudo que não for dígito
            let valor = input.value.replace(/\D/g, '');

            // 2. Garante que tenha pelo menos dois dígitos para os centavos
            if (valor.length === 0) {
                input.value = '0,00';
                return;
            } else if (valor.length === 1) {
                valor = '00' + valor;
            } else if (valor.length === 2) {
                valor = '0' + valor;
            }

            // 3. Insere a vírgula (centavos)
            let parteInteira = valor.slice(0, -2);
            let parteDecimal = valor.slice(-2);

            // 4. Insere os pontos (milhares)
            let resultado = '';
            while (parteInteira.length > 3) {
                resultado = '.' + parteInteira.slice(-3) + resultado;
                parteInteira = parteInteira.slice(0, -3);
            }
            resultado = parteInteira + resultado + ',' + parteDecimal;

            input.value = resultado;

            // Chamar funções de cálculo dependentes
            if (input.id === 'adv-base-calculo' || input.id === 'adv-valor-fixado') {
                calcularHonorarios('adv');
            } else if (input.id === 'perito-base-calculo' || input.id === 'perito-valor-fixado') {
                calcularHonorarios('perito');
            } else if (input.id === 'valor-bruto-reclamante') {
                // Atualiza as bases de cálculo e recalcula os honorários (que chamam calcularValorLiquido)
                atualizarBasesDeCalculo();
                // Atualiza displays
                atualizarValorBrutoDisplay();
                calcularValorLiquido(); // Garante o cálculo do líquido no final
                atualizarAlertaBruto();
            }
            // NOVO: Chamada de cálculo para INSS/IR se forem alterados via formatarMoeda
            if (input.id === 'inss-reclamante' || input.id === 'inss-reclamada' || input.id === 'ir-valor') {
                calcularValorLiquido();
            }
        }

        function formatarPercentual(input) {
            let valor = input.value.replace(/[^0-9,]/g, ''); // Permite dígitos e vírgula
            let partes = valor.split(',');
            // Permite no máximo uma vírgula
            if (partes.length > 2) {
                valor = partes[0] + ',' + partes.slice(1).join('');
            }
            // Limita a duas casas decimais
            if (partes.length === 2) {
                partes[1] = partes[1].substring(0, 2);
                valor = partes.join(',');
            }
            // Remove zeros iniciais, exceto se for "0" ou "0,"
            if (partes[0].length > 1 && partes[0].startsWith('0') && !valor.startsWith('0,')) {
                valor = valor.substring(1);
            }
            // Limita a 100
            const num = parseFloat(valor.replace(',', '.')) || 0;
            if (num > 100) {
                input.value = "100";
            } else if (num < 0) {
                input.value = "0";
            } else {
                input.value = valor;
            }

            // Sempre recalcula os credores adicionais
            if (input.id.includes('adv-ad-percentual')) {
                atualizarCredoresAdicionais();
            }
        }

        function atualizarValorBrutoDisplay() {
            const valorBruto = getNumericValue('valor-bruto-reclamante');
            const valorBrutoFormatado = formatarMoedaParaExibicao(valorBruto);

            document.getElementById('valor-bruto-header').textContent = valorBrutoFormatado;
            document.getElementById('valor-bruto-tabela-display').textContent = valorBrutoFormatado;
        }

        function atualizarBasesDeCalculo() {
            const valorBruto = getNumericValue('valor-bruto-reclamante');
            const valorBrutoFormatado = formatarMoedaParaExibicao(valorBruto);

            // Atualiza a base de cálculo para o advogado se estiver vazio
            const advBaseCalc = document.getElementById('adv-base-calculo');
            if (advBaseCalc.value === '' || advBaseCalc.value === '0,00') {
                advBaseCalc.value = valorBrutoFormatado;
                calcularHonorarios('adv');
            }

            // Atualiza a base de cálculo para o perito se estiver vazio
            const peritoBaseCalc = document.getElementById('perito-base-calculo');
            if (peritoBaseCalc.value === '' || peritoBaseCalc.value === '0,00') {
                peritoBaseCalc.value = valorBrutoFormatado;
                calcularHonorarios('perito');
            }
        }

        function atualizarAlertaBruto() {
            const alertaDiv = document.getElementById('alerta-bruto-tabela');
            const valorBruto = getNumericValue('valor-bruto-reclamante');
            const valorDeposito = getNumericValue('valor-deposito-judicial');

            if (valorDeposito > 0 && valorDeposito !== valorBruto) {
                alertaDiv.style.display = 'block';
                const valorBrutoFormatado = formatarMoedaParaExibicao(valorBruto);
                const valorDepositoFormatado = formatarMoedaParaExibicao(valorDeposito);

                alertaDiv.innerHTML = `
                🚨 **ATENÇÃO:** O Valor Bruto do Crédito (**R$ ${valorBrutoFormatado}**) é **DIFERENTE** do Valor do Depósito Judicial (**R$ ${valorDepositoFormatado}**). O cálculo de liberação será feito com base no **Valor Bruto do Crédito**.
                `;
            } else if (valorDeposito > 0 && valorDeposito === valorBruto) {
                alertaDiv.style.display = 'block';
                const valorBrutoFormatado = formatarMoedaParaExibicao(valorBruto);
                alertaDiv.innerHTML = `
                ✅ **Conferência:** O Valor Bruto do Crédito (**R$ ${valorBrutoFormatado}**) corresponde ao valor do depósito bancário realizado pelo Ente Público Devedor.
                `;
            } else {
                alertaDiv.style.display = 'none';
                alertaDiv.innerHTML = '';
            }
        }

        // =======================================================================
        // FUNÇÕES DE CÁLCULO DE HONORÁRIOS
        // =======================================================================

        function toggleAdvHonorariosFields() {
            const isPercentual = document.getElementById('adv-percentual-opt').checked;
            document.getElementById('adv-percentual-fields').style.display = isPercentual ? 'grid' : 'none';
            document.getElementById('adv-fixado-fields').style.display = isPercentual ? 'none' : 'grid';
            calcularHonorarios('adv');
        }

        function togglePeritoHonorariosFields() {
            const isPercentual = document.getElementById('perito-percentual-opt').checked;
            document.getElementById('perito-percentual-fields').style.display = isPercentual ? 'grid' : 'none';
            document.getElementById('perito-fixado-fields').style.display = isPercentual ? 'none' : 'grid';
            calcularHonorarios('perito');
        }

        function setupHonorariosCalculo(prefix) {
            if (prefix === 'adv') {
                document.getElementById('adv-percentual-opt').addEventListener('change', toggleAdvHonorariosFields);
                document.getElementById('adv-valor-fixado-opt').addEventListener('change', toggleAdvHonorariosFields);
            } else if (prefix === 'perito') {
                document.getElementById('perito-percentual-opt').addEventListener('change', togglePeritoHonorariosFields);
                document.getElementById('perito-valor-fixado-opt').addEventListener('change', togglePeritoHonorariosFields);
            }
        }

        function calcularHonorarios(prefix) {
            let resultado = 0;
            const isPercentual = document.getElementById(`${prefix}-percentual-opt`).checked;

            if (isPercentual) {
                const percentual = getNumericValue(`${prefix}-percentual`) / 100;
                const baseCalculo = getNumericValue(`${prefix}-base-calculo`);
                resultado = baseCalculo * percentual;
            } else {
                resultado = getNumericValue(`${prefix}-valor-fixado`);
            }

            const resultadoFormatado = formatarMoedaParaExibicao(resultado);
            document.getElementById(`${prefix}-resultado`).textContent = resultadoFormatado;

            // Preenchimento automático no quadro de Credores
            if (prefix === 'adv') {
                document.getElementById('valor-honorarios-contratuais').textContent = resultadoFormatado;
                // NOVO: Recalcula a distribuição para advogados adicionais
                atualizarCredoresAdicionais();
            } else if (prefix === 'perito') {
                document.getElementById('valor-honorarios-periciais').textContent = resultadoFormatado;
            }

            calcularValorLiquido();
        }

        // =======================================================================
        // FUNÇÕES NOVAS/EDITADAS (ADVS, HERDEIROS, CÁLCULO LÍQUIDO)
        // =======================================================================
        let advogadoAdicionalCount = 0;
        let herdeiroCount = 0;

        function adicionarAdvogadoAdicional() {
            advogadoAdicionalCount++;
            const listDiv = document.getElementById('adv-adicionais-list');
            const newAdvHTML = `
            <div id="adv-adicional-${advogadoAdicionalCount}" class="parte-adicional-block">
                <h4>Advogado Adicional #${advogadoAdicionalCount}</h4>
                <div class="info-row">
                    <div class="info-item" style="min-width: 400px; flex-grow: 2;">
                        <label for="adv-ad-nome-${advogadoAdicionalCount}">Nome do Advogado/Sociedade:</label>
                        <input type="text" id="adv-ad-nome-${advogadoAdicionalCount}" name="adv-ad-nome-${advogadoAdicionalCount}">
                    </div>
                </div>
                <div class="info-row">
                    <div class="info-item">
                        <label for="adv-ad-percentual-${advogadoAdicionalCount}">Percentual (%) do Honorário Principal:</label>
                        <input type="text" id="adv-ad-percentual-${advogadoAdicionalCount}" class="valor-input" name="adv-ad-percentual-${advogadoAdicionalCount}" placeholder="0,00" oninput="formatarPercentual(this)">
                    </div>
                    <div class="info-item">
                        <label>Valor Calculado:</label>
                        <span id="adv-ad-resultado-${advogadoAdicionalCount}" class="valor-display-style" style="background-color: #f7fcda;">0,00</span>
                    </div>
                </div>
                <button type="button" class="remove-button" onclick="removerParte('adv-adicional-${advogadoAdicionalCount}')">Remover Advogado</button>
            </div>
            `;
            listDiv.insertAdjacentHTML('beforeend', newAdvHTML);
            atualizarCredoresAdicionais(); // Recalcula a distribuição ao adicionar um novo
        }

        function adicionarHerdeiro() {
            herdeiroCount++;
            const listDiv = document.getElementById('herdeiros-list');
            const newHerHTML = `
            <div id="herdeiro-${herdeiroCount}" class="parte-adicional-block">
                <h4>Herdeiro/Sucessor #${herdeiroCount}</h4>
                <div class="info-row herdeiro-row">
                    <div class="info-item">
                        <label for="her-nome-${herdeiroCount}">Nome do Herdeiro/Sucessor:</label>
                        <input type="text" id="her-nome-${herdeiroCount}" name="her-nome-${herdeiroCount}">
                    </div>
                    <div class="info-item">
                        <label for="her-cpf-${herdeiroCount}">CPF:</label>
                        <input type="text" id="her-cpf-${herdeiroCount}" name="her-cpf-${herdeiroCount}" maxlength="14" oninput="formatarDocumento(this, 'CPF')">
                    </div>
                    <div class="info-item">
                        <label for="her-valor-${herdeiroCount}">Valor a Receber:</label>
                        <input type="text" id="her-valor-${herdeiroCount}" class="valor-input" name="her-valor-${herdeiroCount}" placeholder="0,00" oninput="formatarMoeda(this); atualizarCredoresAdicionais();">
                    </div>
                </div>
                <button type="button" class="remove-button" onclick="removerParte('herdeiro-${herdeiroCount}')">Remover Herdeiro</button>
            </div>
            `;
            listDiv.insertAdjacentHTML('beforeend', newHerHTML);
        }

        function removerParte(id) {
            const elemento = document.getElementById(id);
            if (elemento) {
                elemento.remove();
                // Opcional: recontar e renomear se for importante, mas por simplicidade vamos apenas remover e recalcular
                if (id.includes('adv-adicional')) {
                    // Se remover um advogado, recalcula imediatamente
                    atualizarCredoresAdicionais();
                } else if (id.includes('herdeiro')) {
                    // Se remover um herdeiro, recalcula o líquido
                    atualizarCredoresAdicionais();
                }
            }
        }

        function atualizarCredoresAdicionais() {
            const tabelaBody = document.getElementById('creditos-table-body');
            // Remove as linhas de credores adicionais existentes (advogados e herdeiros)
            document.querySelectorAll('.credor-adicional-linha').forEach(row => row.remove());

            let htmlAdicionais = '';
            let totalCredoresAdicionais = 0;
            const honAdvPrincipalNumeric = getNumericValue('adv-resultado'); // Valor numérico do honorário principal

            // Advogados Adicionais
            for (let i = 1; i <= advogadoAdicionalCount; i++) {
                const percentualInput = document.getElementById(`adv-ad-percentual-${i}`);
                const nomeInput = document.getElementById(`adv-ad-nome-${i}`);
                const resultadoSpan = document.getElementById(`adv-ad-resultado-${i}`);

                if (nomeInput && percentualInput) {
                    const percentual = parseFloat(percentualInput.value.replace(',', '.')) || 0;
                    const valorCalculado = (percentual / 100) * honAdvPrincipalNumeric;

                    if (resultadoSpan) {
                        resultadoSpan.textContent = formatarMoedaParaExibicao(valorCalculado);
                    }

                    if (valorCalculado > 0) {
                        totalCredoresAdicionais += valorCalculado;
                        htmlAdicionais += `
                        <tr class="credor-adicional-linha linha-advogado">
                            <td colspan="2">${nomeInput.value || `Advogado Adicional #${i}`} (${percentual.toFixed(2).replace('.', ',')}%)</td>
                            <td class="right-align">
                                <span class="valor-resultado">${formatarMoedaParaExibicao(valorCalculado)}</span>
                            </td>
                        </tr>
                        `;
                    }
                }
            }

            // Herdeiros/Sucessores
            for (let i = 1; i <= herdeiroCount; i++) {
                const nomeInput = document.getElementById(`her-nome-${i}`);
                const valorInput = document.getElementById(`her-valor-${i}`);
                if (nomeInput && valorInput) {
                    const nome = nomeInput.value || `Herdeiro #${i}`;
                    const valor = getNumericValue(`her-valor-${i}`);
                    totalCredoresAdicionais += valor;
                    if (valor > 0) {
                        htmlAdicionais += `
                        <tr class="credor-adicional-linha linha-herdeiro">
                            <td colspan="2">${nome} (Herdeiro/Sucessor)</td>
                            <td class="right-align">
                                <span class="valor-resultado">${formatarMoedaParaExibicao(valor)}</span>
                            </td>
                        </tr>
                        `;
                    }
                }
            }

            // Encontra o ponto de inserção: antes da linha de INSS Reclamante
            const inssReclamanteRow = document.querySelector('.creditos-table .linha-retencao').closest('tr');
            if (inssReclamanteRow) {
                inssReclamanteRow.insertAdjacentHTML('beforebegin', htmlAdicionais);
            } else {
                // Caso a tabela tenha sido alterada, insere no final do tbody (menos ideal)
                tabelaBody.insertAdjacentHTML('beforeend', htmlAdicionais);
            }

            // O total de credores adicionais será usado em calcularValorLiquido()
            calcularValorLiquido(totalCredoresAdicionais);
        }

        function calcularValorLiquido(totalCredoresAdicionais = 0) {
            const valorBruto = getNumericValue('valor-bruto-reclamante');

            // Novos Valores de Dedução
            const inssReclamante = getNumericValue('inss-reclamante');
            const inssReclamada = getNumericValue('inss-reclamada');
            const irValor = getNumericValue('ir-valor');

            // Honorários (já calculados e colocados nos spans)
            const honAdv = getNumericValue('adv-resultado');
            const honPerito = getNumericValue('perito-resultado');

            // Credores adicionais já calculados em atualizarCredoresAdicionais
            // const totalCredoresAdicionais = getNumericValue('total-adv-adicionais') + getNumericValue('total-herdeiros');

            // Somas de Débitos (Retenções)
            const totalDebitos = inssReclamante + inssReclamada + irValor;

            // Somas de Créditos Destinados (Honorários e Credores Adicionais)
            const totalDestinado = honAdv + honPerito + totalCredoresAdicionais;

            // Valor Líquido = Bruto - Débitos - (Honorários Principais) + (Honorários/Herdeiros Adicionais)
            // A fórmula correta para o valor líquido a liberar para o Reclamante/Credor Principal é:
            // Valor Líquido Total = Valor Bruto - Total Débitos - Honorários Principais - Honorários Periciais - Soma dos Valores de Herdeiros
            const valorLiquidoTotal = valorBruto - totalDebitos - honAdv - honPerito - totalCredoresAdicionais;

            // Atualiza o display do valor líquido
            document.getElementById('valor-liquido-total').textContent = formatarMoedaParaExibicao(valorLiquidoTotal);

            // Atualiza o display das retenções
            document.getElementById('valor-inss-reclamante-display').textContent = formatarMoedaParaExibicao(inssReclamante * -1);
            document.getElementById('valor-inss-reclamada-display').textContent = formatarMoedaParaExibicao(inssReclamada * -1);
            document.getElementById('valor-ir-display').textContent = formatarMoedaParaExibicao(irValor * -1);

            // Atualiza o relatório final
            gerarRelatorio(true);
        }

        // =======================================================================
        // FUNÇÕES DE RELATÓRIO E IMPRESSÃO
        // =======================================================================

        function getFullProcessNumber() {
            const num = document.getElementById('proc-num').value;
            const digito = document.getElementById('proc-digito').value;
            const ano = document.getElementById('proc-ano').value;
            const vara = document.getElementById('proc-vara').value;

            if (!num || !digito || !ano || !vara || num.length !== 7 || digito.length !== 2 || ano.length !== 4 || vara.length !== 4) {
                return "Processo Incompleto";
            }

            return `${num}-${digito}.${ano}.5.19.${vara}`;
        }

        function gerarRelatorio(isAutoCall = false) {
            const relatorioDiv = document.getElementById('relatorio-final');

            // 1. DADOS BÁSICOS
            const numProcesso = getFullProcessNumber();
            const reclamante = document.getElementById('reclamante').value || "Não Informado";
            const cpfCnpj = document.getElementById('cpf').value || "Não Informado";

            // 2. DADOS DOS HONORÁRIOS E PERITOS
            const advNome = document.getElementById('adv-nome').value || "Não informado";
            const advCpfCnpj = document.getElementById('adv-cpf-cnpj').value || "Não informado";
            const peritoNome = document.getElementById('perito-nome').value || "Não informado";
            const peritoCpfCnpj = document.getElementById('perito-cpf-cnpj').value || "Não informado";

            // 3. VALORES (pegos dos spans de resultado)
            const valorBruto = document.getElementById('valor-bruto-tabela-display').textContent;
            const honAdv = document.getElementById('valor-honorarios-contratuais').textContent;
            const honPerito = document.getElementById('valor-honorarios-periciais').textContent;
            const inssRec = document.getElementById('valor-inss-reclamante-display').textContent.replace('-', '');
            const inssRecl = document.getElementById('valor-inss-reclamada-display').textContent.replace('-', '');
            const irValor = document.getElementById('valor-ir-display').textContent.replace('-', '');
            const valorLiquidoTotal = document.getElementById('valor-liquido-total').textContent;

            // 4. Listagem de Advogados Adicionais
            let advAdicionaisHTML = '';
            const honAdvPrincipalNumeric = getNumericValue('adv-resultado'); // Numeric value of principal hon
            for (let i = 1; i <= advogadoAdicionalCount; i++) {
                const nomeInput = document.getElementById(`adv-ad-nome-${i}`);
                const percentualInput = document.getElementById(`adv-ad-percentual-${i}`);
                if (nomeInput && nomeInput.value && percentualInput) {
                    const percentual = parseFloat(percentualInput.value.replace(',', '.')) || 0;
                    const valorCalculado = (percentual / 100) * honAdvPrincipalNumeric;
                    if (valorCalculado > 0) {
                        advAdicionaisHTML += `<p><strong>- ${nomeInput.value} (${percentual.toFixed(2).replace('.', '%')}):</strong> <span class="final-value">${formatarMoedaParaExibicao(valorCalculado)}</span></p>`;
                    }
                }
            }

            // 5. Listagem de Herdeiros
            let herdeirosHTML = '';
            for (let i = 1; i <= herdeiroCount; i++) {
                const nomeInput = document.getElementById(`her-nome-${i}`);
                const valor = getNumericValue(`her-valor-${i}`);
                if (nomeInput && nomeInput.value && valor > 0) {
                    herdeirosHTML += `<p><strong>- ${nomeInput.value}:</strong> <span class="final-value">${formatarMoedaParaExibicao(valor)}</span></p>`;
                }
            }

            const totalDebitos = getNumericValue('inss-reclamante') + getNumericValue('inss-reclamada') + getNumericValue('ir-valor');
            if (getNumericValue('valor-bruto-reclamante') === 0) {
                relatorioDiv.style.display = 'none';
                if (!isAutoCall) alert("Por favor, preencha o Valor Bruto do Crédito.");
                return;
            }


            // MONTAGEM FINAL DO RELATÓRIO
            relatorioDiv.innerHTML = `
                <h2>RELATÓRIO DE CONFERÊNCIA DE CÁLCULO</h2>
                <p><strong>Nº do Processo:</strong> <span class="final-value">${numProcesso}</span></p>
                <p><strong>Reclamante/Credor:</strong> <span class="final-value">${reclamante}</span> (CPF/CNPJ: ${cpfCnpj})</p>

                <h3>VALORES GERAIS</h3>
                <p><strong>Valor Bruto do Crédito:</strong> <span class="final-value">${valorBruto}</span></p>

                <h3>DEDUÇÕES LEGAIS (RETENÇÕES)</h3>
                <p><strong>INSS (Reclamante):</strong> <span class="final-value">${inssRec}</span></p>
                <p><strong>INSS (Reclamada - Cota Empregado):</strong> <span class="final-value">${inssRecl}</span></p>
                <p><strong>Imposto de Renda (IR):</strong> <span class="final-value">${irValor}</span></p>
                <p><strong>Total de Deduções:</strong> <span class="final-value">${formatarMoedaParaExibicao(totalDebitos)}</span></p>

                <h3>HONORÁRIOS E CREDORES ADICIONAIS</h3>
                <p><strong>Honorários Contratuais (Advogado ${advNome}):</strong> <span class="final-value">${honAdv}</span></p>
                ${advAdicionaisHTML.length > 0 ? '<h4>Rateio de Honorários (Advogados Adicionais)</h4>' + advAdicionaisHTML : ''}
                <p><strong>Honorários Periciais (Perito ${peritoNome}):</strong> <span class="final-value">${honPerito}</span></p>
                ${herdeirosHTML.length > 0 ? '<h4>Valores de Herdeiros/Sucessores</h4>' + herdeirosHTML : ''}

                <hr style="margin: 20px 0;">
                <p style="font-size: 1.2em;"><strong>VALOR LÍQUIDO TOTAL A LIBERAR:</strong> <span class="final-value liquido">${valorLiquidoTotal}</span></p>
            `;

            relatorioDiv.style.display = 'block';

            // Geração de Mensagens de Impressão (para o rodapé)
            const printMessagesDiv = document.querySelector('.print-messages');
            printMessagesDiv.innerHTML = `
                <p><strong>CONFERÊNCIA:</strong> Planilha de Liberação de Crédito gerada em ${document.getElementById('data-liberacao-header').value} para o processo nº ${numProcesso}.</p>
                <p>O valor líquido de R$ ${valorLiquidoTotal} será liberado em favor do Credor Principal/Reclamante, após as deduções legais e a separação dos honorários e valores de credores adicionais.</p>
            `;

            if (!isAutoCall) {
                alert("Relatório Final Gerado com Sucesso! Role a página para visualizá-lo.");
            }
        }

        function imprimirPlanilha() {
            // Garante que o relatório final esteja gerado antes da impressão
            gerarRelatorio(true);
            window.print();
        }

        function limparCampos() {
            // Lista de todos os IDs de INPUT para limpar
            const idsParaLimpar = [
                'proc-num', 'proc-digito', 'proc-ano', 'proc-vara',
                'reclamante', 'cpf',
                'adv-nome', 'adv-cpf-cnpj', 'adv-percentual', 'adv-base-calculo', 'adv-valor-fixado',
                'perito-nome', 'perito-cpf-cnpj', 'perito-percentual', 'perito-base-calculo', 'perito-valor-fixado',
                'valor-bruto-reclamante', 'valor-deposito-judicial',
                'inss-reclamada', 'inss-reclamante', 'ir-valor', 'ir-aliquota',
            ];

            // Limpa os inputs
            idsParaLimpar.forEach(id => {
                const input = document.getElementById(id);
                if (input && input.tagName === 'INPUT') {
                    input.value = '';
                }
            });

            // Reseta displays de resultados
            document.getElementById('valor-bruto-header').textContent = '0,00';
            document.getElementById('valor-bruto-tabela-display').textContent = '0,00';
            document.getElementById('adv-resultado').textContent = '0,00';
            document.getElementById('perito-resultado').textContent = '0,00';
            document.getElementById('valor-honorarios-contratuais').textContent = '0,00';
            document.getElementById('valor-honorarios-periciais').textContent = '0,00';
            document.getElementById('valor-inss-reclamante-display').textContent = '-0,00';
            document.getElementById('valor-inss-reclamada-display').textContent = '-0,00';
            document.getElementById('valor-ir-display').textContent = '-0,00';
            document.getElementById('valor-liquido-total').textContent = '0,00';

            // Remove advogados e herdeiros adicionais e reseta contadores
            document.getElementById('adv-adicionais-list').innerHTML = '';
            document.getElementById('herdeiros-list').innerHTML = '';
            document.querySelectorAll('.credor-adicional-linha').forEach(row => row.remove()); // Remove linhas da tabela
            advogadoAdicionalCount = 0;
            herdeiroCount = 0;

            // Oculta e limpa o alerta e o relatório
            document.getElementById('alerta-bruto-tabela').style.display = 'none';
            document.getElementById('relatorio-final').style.display = 'none';

            // Reseta radio buttons para o padrão (Percentual)
            document.getElementById('adv-percentual-opt').checked = true;
            toggleAdvHonorariosFields();
            document.getElementById('perito-percentual-opt').checked = true;
            togglePeritoHonorariosFields();

            // Preenche a data de liberação novamente
            preencherDataAtual();
        }

        function preencherDataAtual() {
            const inputDataLiberacao = document.getElementById('data-liberacao-header');
            const hoje = new Date();
            const dataFormatada = hoje.toLocaleDateString('pt-BR');

            if (inputDataLiberacao) {
                inputDataLiberacao.value = dataFormatada;
            }
        }

        // Configura a lógica de toggle/cálculo de honorários no carregamento
        setupHonorariosCalculo('adv');
        setupHonorariosCalculo('perito');

        // Preenche a data e limpa os campos ao carregar a página
        document.addEventListener('DOMContentLoaded', function () {
            preencherDataAtual();
            limparCampos(); // Garante que a lógica de cálculo seja iniciada com campos limpos e resete contadores.
        });
    </script>
</body>

</html>